"use strict";var __decorate=this&&this.__decorate||function(t,e,r,n){var o,i=arguments.length,s=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var u=t.length-1;u>=0;u--)(o=t[u])&&(s=(i<3?o(s):i>3?o(e,r,s):o(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},core_1=require("@angular/core"),http_1=require("@angular/http"),rxjs_1=require("rxjs"),share_provider_enum_1=require("../helpers/share-provider.enum"),ShareButtonsService=function(){function t(t,e){this.http=t,this.jsonp=e,this.windowWidth=500,this.windowHeight=400}return t.prototype.share=function(t,e){switch(t){case share_provider_enum_1.ShareProvider.FACEBOOK:return this.fbShare(e);case share_provider_enum_1.ShareProvider.TWITTER:return this.twitterShare(e);case share_provider_enum_1.ShareProvider.LINKEDIN:return this.linkedInShare(e);case share_provider_enum_1.ShareProvider.REDDIT:return this.redditShare(e);case share_provider_enum_1.ShareProvider.TUMBLR:return this.tumblrShare(e);case share_provider_enum_1.ShareProvider.STUMBLEUPON:return this.stumbleShare(e);case share_provider_enum_1.ShareProvider.GOOGLEPLUS:return this.gPlusShare(e);case share_provider_enum_1.ShareProvider.PINTEREST:return this.pinShare(e);default:return""}},t.prototype.fbShare=function(t){var e="https://www.facebook.com/sharer/sharer.php?u="+t.url;return t.title&&(e+="&title="+t.title),t.description&&(e+="&description="+t.description),t.image&&(e+="&picture="+t.image),e},t.prototype.twitterShare=function(t){var e="https://twitter.com/intent/tweet?url="+t.url;return t.description&&(e+="&text="+t.description),this.twitterAccount&&(e+="&via="+this.twitterAccount),t.tags&&(e+="&hashtags="+t.tags.toString()),e},t.prototype.linkedInShare=function(t){var e="http://www.linkedin.com/shareArticle?url="+t.url;return t.title&&(e+="&title="+t.title),t.description&&(e+="&summary="+t.description),e},t.prototype.redditShare=function(t){var e="http://www.reddit.com/submit?url="+t.url;return t.title&&(e+="&title="+t.title),e},t.prototype.tumblrShare=function(t){var e="http://tumblr.com/widgets/share/tool?canonicalUrl="+t.url;return t.description&&(e+="&caption="+t.description),t.tags&&(e+="&tags="+t.tags),e},t.prototype.stumbleShare=function(t){return"http://www.stumbleupon.com/submit?url="+t.url},t.prototype.gPlusShare=function(t){return"https://plus.google.com/share?url="+t.url},t.prototype.pinShare=function(t){var e="https://in.pinterest.com/pin/create/button/?url="+t.url;if(t.description)e+="&description="+t.description;else{var r=document.querySelector('meta[property="og:description"]').getAttribute("content");e+="&description="+r}if(t.image)e+="&media="+t.image;else{var n=document.querySelector('meta[property="og:image"]').getAttribute("content");e+="&media="+n}return e},t.prototype.count=function(t,e){switch(t){case share_provider_enum_1.ShareProvider.FACEBOOK:return this.fbCount(e);case share_provider_enum_1.ShareProvider.LINKEDIN:return this.linkedInCount(e);case share_provider_enum_1.ShareProvider.REDDIT:return this.redditCount(e);case share_provider_enum_1.ShareProvider.TUMBLR:return this.tumblrCount(e);case share_provider_enum_1.ShareProvider.GOOGLEPLUS:return this.gPlusCount(e);case share_provider_enum_1.ShareProvider.PINTEREST:return this.pinCount(e);default:return rxjs_1.Observable.empty()}},t.prototype.fbCount=function(t){return this.fetch("https://graph.facebook.com/?id="+t).map(function(t){return t=t.json(),t.hasOwnProperty("share")&&t.share.hasOwnProperty("share_count")?t.share.share_count:0})},t.prototype.linkedInCount=function(t){return this.fetchJsonp("https://www.linkedin.com/countserv/count/share?url="+t).map(function(t){return t=t.json(),0|t.count})},t.prototype.redditCount=function(t){return this.fetch("https://buttons.reddit.com/button_info.json?url="+t).map(function(t){return t=t.json(),t.hasOwnProperty("data")&&t.data.hasOwnProperty("children")&&t.data.children.length?t.data.children[0].data.score:0})},t.prototype.gPlusCount=function(t){var e=exports.gplusCountBody(t);return this.http.post("https://clients6.google.com/rpc?key=AIzaSyCKSbrvQasunBoV16zDH9R33D88CeLr9gQ",e).map(function(t){return t=t.json(),t[0]&&t[0].hasOwnProperty("result")?t[0].result.metadata.globalCounts.count:0})},t.prototype.pinCount=function(t){return this.fetch("https://api.pinterest.com/v1/urls/count.json?callback=receiveCount&url="+t).map(function(t){t=t.text();var e=JSON.parse(t.replace(/^receiveCount\((.*)\)/,"$1"));return 0|e.count})},t.prototype.tumblrCount=function(t){return this.fetchJsonp("https://api.tumblr.com/v2/share/stats?url="+t).map(function(t){return t=t.json(),t.hasOwnProperty("response")&&t.response.hasOwnProperty("note_count")?t.response.note_count:0})},t.prototype.fetch=function(t){return this.http.get(t).catch(function(t){return console.warn("[ShareService HTTP]: ",t),rxjs_1.Observable.empty()})},t.prototype.fetchJsonp=function(t){return this.jsonp.request(t+"&format=jsonp&callback=JSONP_CALLBACK").catch(function(t){return console.warn("[ShareService JSONP]: ",t),rxjs_1.Observable.empty()})},t.prototype.windowAttr=function(){return"width="+this.windowWidth+", height="+this.windowHeight},t=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[http_1.Http,http_1.Jsonp])],t)}();exports.ShareButtonsService=ShareButtonsService,exports.gplusCountBody=function(t){return[{method:"pos.plusones.get",id:"p",params:{nolog:!0,id:t,source:"widget",userId:"@viewer",groupId:"@self"},jsonrpc:"2.0",key:"p",apiVersion:"v1"}]};
//# sourceMappingURL=share-buttons.service.js.map
